(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     12583,        305]
NotebookOptionsPosition[     11437,        282]
NotebookOutlinePosition[     11874,        299]
CellTagsIndexPosition[     11831,        296]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData["Exit"], "Input",
 CellChangeTimes->{{3.8999954403075666`*^9, 3.899995443364493*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"f08fd087-efe2-4a14-a401-6e9f7e67f642"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Needs", "[", "\"\<PM`\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LoadPackages", "[", "\"\<Geometries\>\"", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TestEigensystem", "[", 
    RowBox[{"\[Lambda]_", ",", "U_", ",", "A_"}], "]"}], ":=", 
   RowBox[{"Max", "[", 
    RowBox[{"Abs", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Transpose", "[", "U", "]"}], ".", 
       RowBox[{"Conjugate", "[", 
        RowBox[{"\[Lambda]", " ", "U"}], "]"}]}], "-", "A"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TestEigensystem2", "[", 
    RowBox[{"\[Lambda]_", ",", "U_", ",", "A_"}], "]"}], ":=", 
   RowBox[{"Max", "[", 
    RowBox[{"Abs", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"ConjugateTranspose", "[", "U", "]"}], ".", "A", ".", "U"}], 
      "-", 
      RowBox[{"DiagonalMatrix", "[", "\[Lambda]", "]"}]}], "]"}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.900256984617848*^9, 3.9002569947451487`*^9}, {
   3.906914670654845*^9, 3.906914671719316*^9}, {3.9069179903516617`*^9, 
   3.906917990638061*^9}, 3.906920353573365*^9},
 CellLabel->"In[1]:=",ExpressionUUID->"644dabfc-f850-4a5b-8e8d-2cf663d359d5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"type", "=", "Real"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"matrixCount", "=", "1000000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"threadCount", "=", "8"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"n", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"type", "===", "Real"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", "=", 
      RowBox[{"ToPack", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "\[Transpose]"}], ".", "#"}], "&"}], "/@", 
        RowBox[{"RandomReal", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"matrixCount", ",", "n", ",", "n"}], "}"}]}], "]"}]}], 
       "]"}]}], ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", "=", 
      RowBox[{"ToPack", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"ConjugateTranspose", "[", "#", "]"}], ".", "#"}], "&"}], "/@", 
        RowBox[{"RandomComplex", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "1"}], "-", "I"}], ",", 
            RowBox[{"1", "+", "I"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"matrixCount", ",", "n", ",", "n"}], "}"}]}], "]"}]}], 
       "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.9068925888225813`*^9, 3.9068926166019907`*^9}, 
   3.906892756007769*^9, {3.9068955937615347`*^9, 3.906895594300291*^9}, {
   3.906895684427554*^9, 3.906895687465735*^9}, {3.906895723705194*^9, 
   3.906895724487987*^9}, {3.90689576458952*^9, 3.9068957991764317`*^9}, {
   3.906895841890201*^9, 3.906895841953436*^9}, {3.906896836213244*^9, 
   3.906896836309433*^9}, {3.9068983317100477`*^9, 3.906898333084844*^9}, {
   3.9068983755948677`*^9, 3.9068983766239557`*^9}, {3.906898436381267*^9, 
   3.9068984365836143`*^9}, {3.9068991467937098`*^9, 3.906899149146338*^9}, {
   3.906900020306941*^9, 3.906900053500286*^9}, {3.906900422908924*^9, 
   3.9069004260976973`*^9}, {3.9069005628420773`*^9, 
   3.9069005687804403`*^9}, {3.906901135521534*^9, 3.906901162755342*^9}, {
   3.906901228788245*^9, 3.906901234592224*^9}, {3.9069012839045753`*^9, 
   3.906901284312213*^9}, {3.906901388957428*^9, 3.9069014661239433`*^9}, {
   3.90690653701712*^9, 3.9069065424790688`*^9}, {3.90690906218039*^9, 
   3.906909062452209*^9}, 3.906909130567951*^9, 3.906909173429688*^9, {
   3.9069092938653917`*^9, 3.906909293946474*^9}, {3.906909338773199*^9, 
   3.906909375331115*^9}, {3.906909576835643*^9, 3.90690957732122*^9}, {
   3.9069096490717497`*^9, 3.906909651178241*^9}, {3.906909683909341*^9, 
   3.9069096906228313`*^9}, {3.906912338005773*^9, 3.906912386776743*^9}, {
   3.906912466795274*^9, 3.9069125454475803`*^9}, 3.906912587955023*^9, {
   3.906912632273553*^9, 3.906912677332239*^9}, {3.906914086510944*^9, 
   3.906914087595448*^9}, {3.9069141223376617`*^9, 3.906914122413213*^9}, {
   3.9069142230757847`*^9, 3.9069142235293694`*^9}, {3.906914272381065*^9, 
   3.9069142727471237`*^9}, {3.9069143598162327`*^9, 
   3.9069143672974033`*^9}, {3.9069148207152433`*^9, 3.906914826216428*^9}, 
   3.906915275594418*^9, 3.906915307884519*^9, 3.906915367513905*^9, {
   3.906915927598686*^9, 3.9069159300130444`*^9}, {3.906915963356554*^9, 
   3.906915968978611*^9}, {3.906916902267221*^9, 3.906916914366379*^9}, {
   3.906916970060606*^9, 3.906916995054873*^9}, {3.906917217450737*^9, 
   3.906917218211525*^9}, {3.906917343352866*^9, 3.9069173438027153`*^9}, {
   3.9069173859847727`*^9, 3.906917395121604*^9}, {3.90691747178823*^9, 
   3.906917472864369*^9}, 3.906919198934021*^9, 3.906919642995207*^9, {
   3.90692083432905*^9, 3.906920836213277*^9}, {3.906921635028055*^9, 
   3.906921635353916*^9}, 3.9069217224834843`*^9, {3.906921871990389*^9, 
   3.906921872167265*^9}},
 CellLabel->
  "In[117]:=",ExpressionUUID->"b0070ecc-be91-48ec-985e-0035bd4ce354"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Lambda]True", ",", "UTrue"}], "}"}], "=", 
    RowBox[{"Transpose", "[", 
     RowBox[{"Eigensystem", "/@", "A"}], "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}], "\[IndentingNewLine]", 
 RowBox[{"Max", "[", 
  RowBox[{"MapThread", "[", 
   RowBox[{"TestEigensystem", ",", 
    RowBox[{"{", 
     RowBox[{"\[Lambda]True", ",", "UTrue", ",", "A"}], "}"}]}], "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Max", "[", 
  RowBox[{"MapThread", "[", 
   RowBox[{"TestEigensystem2", ",", 
    RowBox[{"{", 
     RowBox[{"\[Lambda]True", ",", 
      RowBox[{"Transpose", "/@", "UTrue"}], ",", "A"}], "}"}]}], "]"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.906917998064983*^9, 3.90691805543854*^9}, {
   3.9069184240829697`*^9, 3.906918424402664*^9}, 3.9069201910843067`*^9, 
   3.906920840058463*^9},
 CellLabel->
  "In[122]:=",ExpressionUUID->"4ca05054-e287-485b-a01f-2a38744df52b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Lambda]", ",", "U"}], "}"}], "=", 
    RowBox[{"HermitianEigensystems", "[", 
     RowBox[{"A", ",", 
      RowBox[{"\"\<ThreadCount\>\"", "->", "threadCount"}], ",", 
      RowBox[{"Method", "->", "\"\<LowDimensional\>\""}]}], "]"}]}], ";"}], "//",
   "RepeatedTiming"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"errors", "=", 
   RowBox[{"MapThread", "[", 
    RowBox[{"TestEigensystem2", ",", 
     RowBox[{"{", 
      RowBox[{"\[Lambda]", ",", "U", ",", "A"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Max", "[", "errors", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Mean", "[", "errors", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Median", "[", "errors", "]"}]}], "Input",
 CellChangeTimes->{
  3.9069139041885357`*^9, {3.90691396323114*^9, 3.9069139634628887`*^9}, {
   3.9069146796000433`*^9, 3.9069146805360403`*^9}, 3.906914793973455*^9, {
   3.906915262697319*^9, 3.906915264507172*^9}, 3.9069158870406427`*^9, {
   3.906915943738159*^9, 3.906915950181758*^9}, {3.906916056076042*^9, 
   3.9069160588345327`*^9}, {3.906916727000277*^9, 3.906916750419362*^9}, {
   3.906916861077232*^9, 3.9069168959822903`*^9}, 3.906917167540855*^9, 
   3.9069174503626833`*^9, 3.906917981248198*^9, {3.906918414337043*^9, 
   3.906918421765794*^9}, {3.906921742638733*^9, 3.906921743302758*^9}, {
   3.906921794461879*^9, 3.906921823177547*^9}},
 CellLabel->
  "In[130]:=",ExpressionUUID->"9ea4689e-1ad2-4cb2-9060-c9058853a5ac"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Lambda]", ",", "U"}], "}"}], "=", 
    RowBox[{"HermitianEigensystems", "[", 
     RowBox[{"A", ",", 
      RowBox[{"\"\<ThreadCount\>\"", "->", "threadCount"}], ",", 
      RowBox[{"Method", "->", "\"\<LAPACK\>\""}]}], "]"}]}], ";"}], "//", 
  "RepeatedTiming"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"errors", "=", 
   RowBox[{"MapThread", "[", 
    RowBox[{"TestEigensystem2", ",", 
     RowBox[{"{", 
      RowBox[{"\[Lambda]", ",", "U", ",", "A"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Max", "[", "errors", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Mean", "[", "errors", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Median", "[", "errors", "]"}]}], "Input",
 CellChangeTimes->{{3.906918433125741*^9, 3.9069184339266243`*^9}, 
   3.906921745025961*^9, 3.906921830060052*^9},
 CellLabel->
  "In[135]:=",ExpressionUUID->"61412e01-d19d-4fb6-82cf-f374b41e4149"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Lambda]2", ",", "U2"}], "}"}], "=", 
      RowBox[{"Eigensystems3D", "[", "A", "]"}]}], ";"}], "//", 
    "AbsoluteTiming"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Lambda]2", ",", "U2"}], "}"}], "=", 
      RowBox[{"Eigensystems2D", "[", "A", "]"}]}], ";"}], "//", 
    "AbsoluteTiming"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"errors", "=", 
     RowBox[{"MapThread", "[", 
      RowBox[{"TestEigensystem", ",", 
       RowBox[{"{", 
        RowBox[{"\[Lambda]2", ",", "U2", ",", "A"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Max", "[", "errors", "]"}], "\[IndentingNewLine]", 
   RowBox[{"Mean", "[", "errors", "]"}], "\[IndentingNewLine]", 
   RowBox[{"Median", "[", "errors", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.906921626414714*^9, 3.906921631293438*^9}, {
  3.906921664206815*^9, 3.9069216660579453`*^9}, {3.90692183924115*^9, 
  3.906921847360525*^9}, {3.906921902002441*^9, 3.9069219053389473`*^9}},
 CellLabel->
  "In[140]:=",ExpressionUUID->"5273ea9e-7e5c-4b2b-829b-fb835414a53e"],

Cell[BoxData[
 RowBox[{"Max", "[", 
  RowBox[{"Abs", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Sort", "/@", "\[Lambda]2"}], ")"}], "-", 
    RowBox[{"(", 
     RowBox[{"Sort", "/@", "\[Lambda]"}], ")"}]}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.9069216671019087`*^9, 3.906921706345969*^9}},
 CellLabel->
  "In[145]:=",ExpressionUUID->"dfa56f02-0988-4eb1-a95b-eab30b6d3879"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.90692177031816*^9, 3.90692177362424*^9}, 
   3.9069219138141317`*^9},
 CellLabel->
  "In[146]:=",ExpressionUUID->"86edc579-dbb3-4915-91db-9ca866fb0189"]
},
WindowSize->{1496, 905},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
TaggingRules-><|"TryRealOnly" -> False|>,
FrontEndVersion->"13.2 for Mac OS X ARM (64-bit) (January 30, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"fab14467-30fa-4805-b375-44e65b353e31"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 177, 2, 41, "Input",ExpressionUUID->"f08fd087-efe2-4a14-a401-6e9f7e67f642"],
Cell[738, 24, 1274, 33, 142, "Input",ExpressionUUID->"644dabfc-f850-4a5b-8e8d-2cf663d359d5"],
Cell[2015, 59, 4123, 81, 242, "Input",ExpressionUUID->"b0070ecc-be91-48ec-985e-0035bd4ce354"],
Cell[6141, 142, 961, 26, 92, "Input",ExpressionUUID->"4ca05054-e287-485b-a01f-2a38744df52b"],
Cell[7105, 170, 1524, 32, 142, "Input",ExpressionUUID->"9ea4689e-1ad2-4cb2-9060-c9058853a5ac"],
Cell[8632, 204, 970, 24, 142, "Input",ExpressionUUID->"61412e01-d19d-4fb6-82cf-f374b41e4149"],
Cell[9605, 230, 1233, 32, 167, "Input",ExpressionUUID->"5273ea9e-7e5c-4b2b-829b-fb835414a53e"],
Cell[10841, 264, 388, 10, 41, "Input",ExpressionUUID->"dfa56f02-0988-4eb1-a95b-eab30b6d3879"],
Cell[11232, 276, 201, 4, 41, "Input",ExpressionUUID->"86edc579-dbb3-4915-91db-9ca866fb0189"]
}
]
*)

